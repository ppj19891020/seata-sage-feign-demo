{
  "Name": "orderProcess",
  "Comment": "模拟saga流程",
  "StartState": "CreateOrder",
  "Version": "1.0.0",
  "States": {
    "CreateOrder": {
      "Comment": "下单流程",
      "Type": "ServiceTask",
      "ServiceName": "orderService",
      "ServiceMethod": "createOrder",
      "CompensateState": "CompensateCreateOrder",
      "Input": [{
        "userId":"$.[order].userId",
        "productId": "$.[order].productId",
        "count": "$.[order].count",
        "price": "$.[order].price"
      }],
      "Output": {
        "orderNo": "$.#root"
      },
      "Status": {
        "$Exception{java.lang.Throwable}": "UN",
        "#root != null": "SU",
        "#root == null": "FA"
      },
      "Catch": [
        {
          "Exceptions": [
            "java.lang.Throwable","java.lang.RuntimeException"
          ],
          "Next": "CompensationTrigger"
        }],
      "Next": "NotifyCreateOrder"
    },
    "NotifyCreateOrder": {
      "Comment": "下单通知消息",
      "Type": "ServiceTask",
      "ServiceName": "orderService",
      "ServiceMethod": "orderCreateMessage",
      "Input": [
        "$.[orderNo]"
      ],
      "Next": "Succeed"
    },
    "CompensateCreateOrder": {
      "Comment": "补偿下单操作",
      "Type": "ServiceTask",
      "ServiceName": "orderService",
      "ServiceMethod": "createOrderFailMessage",
      "Input": [{
        "userId":"$.[order].userId",
        "productId": "$.[order].productId",
        "count": "$.[order].count",
        "price": "$.[order].price"
      }],
      "Status": {
        "$Exception{java.lang.Throwable}": "UN",
        "#root == true": "SU",
        "#root != true": "FA"
      }
    },
    "CompensationTrigger": {
      "Comment": "触发补偿",
      "Type": "CompensationTrigger",
      "Next":"Fail"
    },
    "Succeed": {
      "Type":"Succeed"
    },
    "Fail": {
      "Type":"Fail",
      "ErrorCode": "ORDER_CREATE_FAILED",
      "Message": "purchase failed"
    }
  }
}